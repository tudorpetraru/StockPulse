{% extends "base.html" %}

{% block title %}Watchlist â€” StockPulse{% endblock %}

{% block content %}
<div class="page-header-row">
  <h2 class="page-title">Watchlists</h2>
  <div class="page-header-actions">
    <span class="text-muted page-refresh-meta">Last refreshed: {{ last_refreshed }}</span>
    <a class="btn btn-sm"
       data-action="refresh"
       href="/watchlist?watchlist_id={{ active_watchlist.id }}&sort_by={{ sort_by }}&sort_dir={{ sort_dir }}&refresh=1">Refresh</a>
  </div>
</div>

<div class="sp-tabs">
  {% for wl in watchlists %}
  <a href="/watchlist?watchlist_id={{ wl.id }}"
     class="sp-tab {{ 'active' if wl.id == active_watchlist.id }}">
    {{ wl.name }} ({{ wl.items | length }})
  </a>
  {% endfor %}
  <div x-data="{ open: false }" class="watchlist-new-inline">
    <button type="button" class="sp-tab watchlist-new-button" @click="open = !open">+ New List</button>
    <form x-show="open" action="/api/watchlists" method="post" class="watchlist-new-form">
      <input type="hidden" name="csrf_token" value="">
      <label class="visually-hidden" for="watchlist-name-input">Watchlist Name</label>
      <input id="watchlist-name-input" class="sp-input" name="name" placeholder="List name" required>
      <button type="submit" class="btn btn-primary btn-sm">Create</button>
    </form>
  </div>
</div>

<form hx-post="/api/watchlist-items"
      hx-target="#watchlist-table"
      hx-swap="innerHTML"
      class="watchlist-add-form">
  <input type="hidden" name="csrf_token" value="">
  <input type="hidden" name="watchlist_id" value="{{ active_watchlist.id }}">
  <input type="hidden" name="sort_by" value="{{ sort_by }}">
  <input type="hidden" name="sort_dir" value="{{ sort_dir }}">
  <label class="visually-hidden" for="watchlist-ticker-input">Ticker</label>
  <input id="watchlist-ticker-input" type="text" class="sp-input watchlist-add-input" name="ticker" placeholder="Add ticker (e.g., TSLA)" required>
  <button type="submit" class="btn btn-primary watchlist-add-btn">+ Add</button>
</form>

<div id="watchlist-table">
  {% include "partials/watchlist_table.html" %}
</div>
{% endblock %}
