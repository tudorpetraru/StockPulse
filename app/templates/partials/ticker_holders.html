<!-- Holders tab partial -->
{% if status == "error" %}
<div class="alert alert-error">‚ùå Holder data temporarily unavailable. <a hx-get="/hx/ticker/{{ symbol }}/holders"
        hx-target="#tab-content" hx-swap="innerHTML">Click to retry.</a></div>
{% else %}
{% macro holders_table(title, rows) %}
<div class="card">
    <div class="card-title">{{ title }}</div>
    {% if rows %}
    <table class="wf-table">
        <thead>
            <tr>
                <th>Holder</th>
                <th>Shares</th>
                <th>% In (of AAPL shares)</th>
                <th>Change vs Prev Filing</th>
                <th>AAPL Position Value</th>
                <th>Date</th>
            </tr>
        </thead>
        <tbody>
            {% for h in rows %}
            <tr>
                <td style="font-weight:500;">{{ h.name }}</td>
                <td>{{ "{:,.0f}".format(h.shares) if h.shares is not none else "N/A" }}</td>
                <td>{{ "%.2f"|format(h.pct_in) if h.pct_in is not none else "N/A" }}{% if h.pct_in is not none %}%{% endif %}</td>
                <td>
                    {% if h.pct_change is not none %}
                    {{ "{:+.2f}%".format(h.pct_change) }}
                    {% else %}
                    N/A
                    {% endif %}
                </td>
                <td>{{ "${:,.0f}".format(h.value) if h.value is not none else "N/A" }}</td>
                <td>{{ h.date }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <p style="color:var(--gray-500);font-size:12px;margin:10px 0 0;">
        <strong>Note:</strong> % In is each holder's share of AAPL shares outstanding. Change is filing-to-filing position change (13F periods), not monthly trade flow. This table does not include each fund's full portfolio weight in AAPL.
    </p>
    {% else %}
    <p style="color:var(--gray-500);font-size:13px;">No data available.</p>
    {% endif %}
</div>
{% endmacro %}

{{ holders_table("Top Institutional Holders", holders.institutional) }}
{{ holders_table("Top Mutual Fund Holders", holders.mutual_fund) }}
{% endif %}
